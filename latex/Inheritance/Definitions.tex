\subsection{Agda Standard Library Notation}
\label{sec:semantic-definitions:standard-library}

The Agda definitions given below use the following modules from the standard library (v2.1).%
\footnote{\url{https://agda.github.io/agda-stdlib/v2.1/}}
%
\begin{AgdaAlign}
\begin{code}%
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{OPTIONS}\AgdaSpace{}%
\AgdaPragma{--safe}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat.Base}%
\>[31]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}≤\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ natural\ numbers\ zero\ ≤\ suc\ zero\ ≤\ ...}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Maybe.Base}%
\>[31]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[43]\AgdaDatatype{Maybe}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaDatatype{\AgdaUnderscore{}+?}\AgdaSymbol{;}%
\>[63]\AgdaComment{--\ A\ +?\ is\ disjoint\ union\ of\ A\ and\ \{??\}}\<%
\\
%
\>[43]\AgdaInductiveConstructor{nothing}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaInductiveConstructor{??}\AgdaSymbol{;}%
\>[63]\AgdaComment{--\ ??\ represents\ absence\ of\ an\ A\ value}\<%
\\
%
\>[43]\AgdaFunction{maybe′}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{[\AgdaUnderscore{},\AgdaUnderscore{}]?}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ [\ f\ ,\ x\ ]?\ is\ case\ analysis\ on\ A\ +?}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product.Base}%
\>[31]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}×\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{},\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{proj₁}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ A\ ×\ B\ is\ Cartesian\ product,\ \AgdaUnderscore{},\AgdaUnderscore{}\ is\ pairing}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Function}%
\>[31]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Inverse}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}↔\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∘\AgdaUnderscore{}}}\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ A\ ↔\ B\ is\ isomorphism\ between\ A\ and\ B}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Inverse}\AgdaSpace{}%
\AgdaSymbol{\{\{}\AgdaSpace{}%
\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{\}\}}%
\>[31]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{from}\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ to\ :\ A\ →\ B;\ from\ :\ B\ →\ A}\<%
\end{code}
%
The declaration \AgdaRef{open Inverse \{\{ ... \}\}} above introduces overloaded functions
\AgdaRef{to} and \AgdaRef{from} for each parameter of the form \AgdaRef{\{\{ i : A ↔ B \}\}}.
The double braces specify instance parameters,
which are the Agda equivalent of Haskell type class constraints.
%(Such isomorphisms are usually left implicit in published semantic definitions.)

\subsection{Domains}

The types and functions declared below as module parameters
correspond to assumptions about features of Scott domains.
These will be used when defining the semantics of method systems in Agda.
An element \AgdaRef{D : Domain} is a type corresponding to a domain used in CP89.
Such a type \AgdaRef{D} has a type of elements \AgdaRef{⟨ D ⟩}
and a distinguished element \AgdaRef{⊥};
further properties of domains
(e.g., involving the partial order on \AgdaRef{⟨ D ⟩})
%the existence of limits of ascending chains,
%\AgdaRef{⊥} being the least element,
%and continuity of functions between domains)
will be needed when proving results about semantic functions.
%
\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Inheritance.Definitions}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Domain}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaPrimitive{Set₁}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ Domain\ is\ a\ type\ of\ cpo}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨\AgdaUnderscore{}⟩}}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaBound{Domain}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ ⟨\ D\ ⟩\ is\ the\ type\ of\ elements\ of\ D}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{⊥}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{D}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ ⊥\ is\ the\ least\ element\ of\ D}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{fix}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{D}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ fix\ f\ is\ the\ least\ fixed-point\ of\ f}\<%
\end{code}
%
The function \AgdaRef{fix} is supposed to correspond to the least fixed-point operator
on the space of continuous functions on a domain.
A continuous function can be represented in Agda as the pair of a function
\AgdaRef{f : ⟨ D ⟩ → ⟨ D ⟩} and a proof of the continuity of \AgdaRef{f}.
In practice, however, \AgdaRef{fix} will be applied only to functions on \AgdaRef{⟨ D ⟩}
defined by lambda-abstraction and application, which ensures their continuity.
It seems pointless to pass an \emph{assumption} of continuity as an argument
– the same assumption can be made wherever it is needed – and its omission does not affect type-checking.

The following declarations correspond closely to the notation for separated sums of domains in CP89,
except that the injection functions \AgdaRef{inl} and \AgdaRef{inr} are left implicit there.
%
\begin{code}%
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{?⊥}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaBound{Domain}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ the\ only\ element\ of\ ?⊥\ is\ ⊥}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{\AgdaUnderscore{}+⊥\AgdaUnderscore{}}}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaBound{Domain}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ D\ +⊥\ E\ is\ the\ separated\ sum\ of\ D\ and\ E}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{inl}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{D}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{+⊥}}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ inl\ injects\ elements\ of\ D\ into\ D\ +⊥\ E}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{inr}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{D}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{+⊥}}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[63]\AgdaComment{--\ inr\ injects\ elements\ of\ E\ into\ D\ +⊥\ E}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{[\AgdaUnderscore{},\AgdaUnderscore{}]⊥}}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{D}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}%
\>[63]\AgdaComment{--\ [\ f\ ,\ g\ ]⊥\ is\ case\ analysis\ on\ D\ +⊥\ E}\<%
\\
\>[17][@{}l@{\AgdaIndent{0}}]%
\>[19]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{+⊥}}\AgdaSpace{}%
\AgdaBound{E}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
%
The Cartesian products of types provided by the standard Agda library support products of domains,
regarding a pair \AgdaRef{(⊥ , ⊥)} as the least element of the product of two domains.  

\subsection{Method Systems}

The method systems defined in CP89 are a simple formalization of object-oriented programming.
They abstract from aspects such as instance variables, assignment, and object creation.
A method system corresponds to a snapshot in the execution of an object-oriented system.

In CP89, the ingredients of method systems are assumed to be elements of flat domains;
however, the least elements of these domains are irrelevant,
and it is simpler to declare them as ordinary Agda types instead of domains:
%
\begin{code}%
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Instance}%
\>[17]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[32]\AgdaComment{--\ objects}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Name}%
\>[17]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[32]\AgdaComment{--\ class\ names}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Key}%
\>[17]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[32]\AgdaComment{--\ method\ names}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Primitive}%
\>[17]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[32]\AgdaComment{--\ function\ names}\<%
\end{code}
%
Both the operational and the denotational semantics of method systems in CP89 involve
the mutually-recursive domains \AgdaRef{Value}, \AgdaRef{Behavior}, and \AgdaRef{Fun}.
These domains cannot be defined (safely) as Agda types,
due to the termination check on recursive type definitions.
Scott domain theory ensures the existence of isomorphisms between the types of elements of these domains
when the elements of \AgdaRef{⟨ Value ⟩ → ⟨ Value ⟩} are restricted to continuous functions.
However, this restriction is irrelevant for checking the types of functions on domains,
so it is omitted.
%
\begin{code}%
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Number}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[32]\AgdaComment{--\ the\ domain\ of\ numbers\ is\ unconstrained}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Value}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[32]\AgdaComment{--\ a\ value\ is\ (isomorphic\ to)\ a\ behavior\ or\ a\ number}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Behavior}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[32]\AgdaComment{--\ a\ behaviour\ maps\ a\ method\ name\ to\ a\ fun,\ or\ to\ the\ only\ element\ of\ ?⊥}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Fun}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[32]\AgdaComment{--\ a\ fun\ maps\ an\ argument\ value\ to\ a\ value\ (possibly\ ⊥)}\<%
\\
%
\>[4]\AgdaSymbol{\{\{}\AgdaSpace{}%
\AgdaBound{isoᵛ}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Value}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}%
\>[32]\AgdaOperator{\AgdaFunction{↔}}%
\>[35]\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{+⊥}}\AgdaSpace{}%
\AgdaBound{Number}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}%
\>[62]\AgdaSymbol{\}\}}\<%
\\
%
\>[4]\AgdaSymbol{\{\{}\AgdaSpace{}%
\AgdaBound{isoᵇ}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}%
\>[32]\AgdaOperator{\AgdaFunction{↔}}%
\>[35]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Key}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Fun}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{+⊥}}\AgdaSpace{}%
\AgdaBound{?⊥}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[62]\AgdaSymbol{\}\}}\<%
\\
%
\>[4]\AgdaSymbol{\{\{}\AgdaSpace{}%
\AgdaBound{isoᶠ}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Fun}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}%
\>[32]\AgdaOperator{\AgdaFunction{↔}}%
\>[35]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Value}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Value}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[62]\AgdaSymbol{\}\}}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{apply⟦\AgdaUnderscore{}⟧}}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Primitive}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Value}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Value}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0][@{}l@{\AgdaIndent{3}}]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaKeyword{variable}\AgdaSpace{}%
\AgdaGeneralizable{ρ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Instance}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaGeneralizable{m}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Key}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaGeneralizable{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Primitive}\<%
\\
\>[0]\AgdaKeyword{variable}\AgdaSpace{}%
\AgdaGeneralizable{ν}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Number}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaGeneralizable{α}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Value}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaGeneralizable{σ}\AgdaSpace{}%
\AgdaGeneralizable{π}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaGeneralizable{φ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Fun}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\<%
\end{code}
%
In the operational and denotational semantics of method systems in CP89,
elements $f$ of the flat domain \textbf{Primitive} are treated
as if they are elements of the function domain \textbf{Fun}.
When checking the corresponding part of the Agda formulation,
the Agda type checker reported this as an error.
The semantic function \AgdaRef{apply⟦ ⟧} declared above is assumed to map
elements of \AgdaRef{Primitive} to functions on \AgdaRef{⟨ Value ⟩},
and its use fixed the error.

In CP89, the inheritance hierarchy is assumed to be a finite tree.
Below, \AgdaRef{Class} is defined as the datatype of all finite trees.
Using a datatype avoids the need for the partial \textit{parent} function,
and for a predicate for testing whether a class is the root of the hierarchy.
%
\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{child}%
\>[10]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Name}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Class}%
\>[34]\AgdaComment{--\ a\ subclass}\<%
\\
%
\>[2]\AgdaInductiveConstructor{origin}%
\>[10]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Class}%
\>[34]\AgdaComment{--\ the\ root\ class}\<%
\\
\>[0]\AgdaKeyword{variable}\AgdaSpace{}%
\AgdaGeneralizable{κ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Class}\<%
\end{code}
%
The syntax of method expressions is defined by the inductive datatype \AgdaRef{Exp}:
%
\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{self}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}%
\>[44]\AgdaComment{--\ refers\ to\ the\ behavior\ of\ the\ current\ object}\<%
\\
%
\>[2]\AgdaInductiveConstructor{super}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}%
\>[44]\AgdaComment{--\ refers\ to\ the\ behavior\ in\ the\ superclass\ of\ the\ object}\<%
\\
%
\>[2]\AgdaInductiveConstructor{arg}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}%
\>[44]\AgdaComment{--\ refers\ to\ the\ single\ argument\ of\ the\ method\ expression}\<%
\\
%
\>[2]\AgdaInductiveConstructor{call}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Key}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}%
\>[44]\AgdaComment{--\ "call\ e₁\ m\ e₂"\ calls\ method\ m\ of\ e₁\ with\ argument\ e₂}\<%
\\
%
\>[2]\AgdaInductiveConstructor{appl}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Primitive}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}%
\>[44]\AgdaComment{--\ "appl\ f\ e₁"\ applies\ primitive\ f\ to\ e₁}\<%
\\
\>[0]\AgdaKeyword{variable}\AgdaSpace{}%
\AgdaGeneralizable{e}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Semantics}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{class}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Instance}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[44]\AgdaComment{--\ "class\ ρ"\ is\ the\ class\ of\ an\ object}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{methods′}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Key}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{+?}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[44]\AgdaComment{--\ "methods′\ κ\ m"\ is\ the\ method\ named\ m\ in\ κ}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{methods}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Key}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{+?}}\AgdaSymbol{)}%
\>[44]\AgdaComment{--\ "methods\ origin"\ overrides\ "methods′\ origin"}\<%
\\
%
\>[2]\AgdaFunction{methods}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{child}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{m}%
\>[25]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{methods′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{child}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{m}\<%
\\
%
\>[2]\AgdaFunction{methods}\AgdaSpace{}%
\AgdaInductiveConstructor{origin}\AgdaSpace{}%
\AgdaBound{m}%
\>[25]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{??}\<%
\end{code}

\subsection{Method Lookup Semantics}

The method lookup semantics uses mutually-recursive functions 
\AgdaRef{send}, \AgdaRef{lookup}, and \AgdaRef{do⟦ ⟧},
which can be non-terminating, 
They are therefore defined in Agda as the least fixed-point
of a non-recursive function \AgdaRef{g}
(as in the proof of Proposition~3 in CP89) on a domain \AgdaRef{Gᵍ}
that is isomorphic to~\AgdaRef{Dᵍ}:
%
\begin{code}%
%
\>[2]\AgdaFunction{Dᵍ}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[8]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{Instance}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\<%
\\
%
\>[8]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Instance}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\<%
\\
%
\>[8]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Instance}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Fun}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaBound{Gᵍ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Domain}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{\{}\AgdaSpace{}%
\AgdaBound{isoᵍ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Gᵍ}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{↔}}\AgdaSpace{}%
\AgdaFunction{Dᵍ}\AgdaSpace{}%
\AgdaSymbol{\}\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaKeyword{where}\<%
\\
%
\>[4]\AgdaFunction{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Dᵍ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Dᵍ}\<%
\\
%
\>[4]\AgdaFunction{g}%
\>[353I]\AgdaSymbol{(}\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{d⟦\AgdaUnderscore{}⟧}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{send}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{lookup}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{do⟦\AgdaUnderscore{}⟧}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
%
The behavior of \AgdaRef{send ρ} is to use \AgdaRef{lookup} 
(to be supplied as the argument \AgdaRef{l} of \AgdaRef{g} above)
to obtain the behavior of \AgdaRef{ρ} using the class of \AgdaRef{ρ} itself:
%
\begin{code}%
\>[.][@{}l@{}]\<[353I]%
\>[6]\AgdaFunction{send}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Instance}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\<%
\\
%
\>[6]\AgdaFunction{send}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{class}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ρ}\<%
\end{code}
%
The behavior of \AgdaRef{lookup κ ρ} for a subclass \AgdaRef{κ} 
depends on whether it is called with a method \AgdaRef{m} defined by \AgdaRef{κ}:
if so, it uses \AgdaRef{do⟦ e ⟧} (via argument \AgdaRef{d⟦ ⟧} of \AgdaRef{g})
to execute the corresponding method expression;
if not, it recursively looks up \AgdaRef{m} in the superclass of {κ}.
%\footnote{The isomorphisms \AgdaRef{to} and \AgdaRef{from} can be ignored.}
The behavior is undefined when \AgdaRef{κ} is the root of the inheritance hierarchy,
which has been defined to have no methods:
%
\begin{code}%
%
\>[6]\AgdaFunction{lookup}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Instance}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\<%
\\
%
\>[6]\AgdaFunction{lookup}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{child}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ρ}%
\>[28]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{→}%
\>[42]\AgdaOperator{\AgdaFunction{[}}%
\>[45]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{inl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaBound{d⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟧}}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{child}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{,}}\<%
\\
%
\>[45]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[42]\AgdaOperator{\AgdaFunction{]?}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{methods}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{child}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaFunction{lookup}\AgdaSpace{}%
\AgdaInductiveConstructor{origin}\AgdaSpace{}%
\AgdaBound{ρ}%
\>[28]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{⊥}\<%
\end{code}
%
When applied to a value \AgdaRef{α}, the value returned by the function \AgdaRef{to (do⟦ e ⟧ ρ κ)} may be
a behavior, a number, or undefined (\AgdaRef{⊥}):
%
\begin{code}%
%
\>[6]\AgdaOperator{\AgdaFunction{do⟦\AgdaUnderscore{}⟧}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Instance}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Fun}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{do⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{self}%
\>[24]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaBound{κ}%
\>[41]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{inl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSymbol{))}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{do⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{super}%
\>[24]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{child}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{)}%
\>[41]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{inl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSymbol{))}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{do⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{super}%
\>[24]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaInductiveConstructor{origin}%
\>[41]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{⊥}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{do⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{arg}%
\>[24]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaBound{κ}%
\>[41]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{α}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{do⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{call}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{e₂}%
\>[24]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaBound{κ}%
\>[41]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}%
\>[481I]\AgdaOperator{\AgdaBound{[}}%
\>[482I]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{→}%
\>[486I]\AgdaOperator{\AgdaBound{[}}%
\>[67]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaBound{d⟦}}\AgdaSpace{}%
\AgdaBound{e₂}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟧}}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{α}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{,}}\<%
\\
%
\>[67]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{⊥}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[486I]%
\>[64]\AgdaOperator{\AgdaBound{]⊥}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{,}}\<%
\\
\>[.][@{}l@{}]\<[482I]%
\>[56]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{ν}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{⊥}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[481I]%
\>[54]\AgdaOperator{\AgdaBound{]⊥}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaBound{d⟦}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟧}}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{α}\AgdaSymbol{))}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{do⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{appl}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{e₁}%
\>[24]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaBound{κ}%
\>[41]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{apply⟦}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟧}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaBound{d⟦}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟧}}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{α}\AgdaSymbol{)}\<%
\end{code}
%
The only complicated case is for calling method \AgdaRef{m} of object \AgdaRef{e₁} 
with argument \AgdaRef{e₂}.
When the value of \AgdaRef{e₁} is a behavior \AgdaRef{σ} that maps \AgdaRef{m} to a function \AgdaRef{φ},
that function is applied to the value of \AgdaRef{e₂};
otherwise the value of the call is undefined.
The undefined cases are not explicit in CP89.

The use of \AgdaRef{fix} below has the effect of making the above definitions mutually recursive:
%
\begin{code}%
%
\>[4]\AgdaFunction{γ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Gᵍ}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Gᵍ}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\<%
\\
%
\>[4]\AgdaFunction{γ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∘}}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∘}}\AgdaSpace{}%
\AgdaField{to}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{send}%
\>[13]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fix}\AgdaSpace{}%
\AgdaFunction{γ}\AgdaSymbol{))}\<%
\\
%
\>[4]\AgdaFunction{lookup}%
\>[13]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{proj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fix}\AgdaSpace{}%
\AgdaFunction{γ}\AgdaSymbol{)))}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{do⟦\AgdaUnderscore{}⟧}}%
\>[13]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{proj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fix}\AgdaSpace{}%
\AgdaFunction{γ}\AgdaSymbol{)))}\<%
\end{code}
%
That completes the definition of the method lookup semantics.

\subsection{Denotational Semantics}

The denotational semantics of method expressions takes the behavior of the 
expressions \AgdaRef{self} (\AgdaRef{σ})
and \AgdaRef{super} (\AgdaRef{π}) as arguments, so their evaluation is trivial.
The evaluation of the other method expressions is similar to their method lookup semantics.
%
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{eval⟦\AgdaUnderscore{}⟧}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Fun}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{eval⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{self}%
\>[22]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaBound{π}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{inl}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{eval⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{super}%
\>[22]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaBound{π}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{inl}\AgdaSpace{}%
\AgdaBound{π}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{eval⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{arg}%
\>[22]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaBound{π}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{α}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{eval⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{call}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{e₂}%
\>[22]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaBound{π}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}%
\>[624I]\AgdaOperator{\AgdaBound{[}}%
\>[625I]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{σ′}\AgdaSpace{}%
\AgdaSymbol{→}%
\>[629I]\AgdaOperator{\AgdaBound{[}}%
\>[56]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{eval⟦}}\AgdaSpace{}%
\AgdaBound{e₂}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaBound{π}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{α}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{,}}\<%
\\
%
\>[56]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{⊥}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[629I]%
\>[53]\AgdaOperator{\AgdaBound{]⊥}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{σ′}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{,}}\<%
\\
\>[.][@{}l@{}]\<[625I]%
\>[44]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{ν}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{⊥}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[624I]%
\>[42]\AgdaOperator{\AgdaBound{]⊥}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{eval⟦}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaBound{π}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{α}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{eval⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{appl}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{e₁}%
\>[22]\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaBound{π}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{α}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{apply⟦}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟧}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{eval⟦}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaBound{π}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{α}\AgdaSymbol{)}\<%
\end{code}
%
The recursively-defined function \AgdaRef{eval⟦ ⟧} is obviously total,
so there is no need for an explicit fixed point in its Agda definition.

According to the conceptual analysis of inheritance in CP89,
the behavior of an instance \AgdaRef{ρ} will be defined as the fixed point
of the generator associated with the class of \AgdaRef{ρ}.

The generator for a subclass is obtained by modifying the generator of its parent class
using a wrapper that provides the behavior of the methods defined by the subclass,
given the behavior of the expressions \AgdaRef{self} (\AgdaRef{σ})
and \AgdaRef{super} (\AgdaRef{π}) as arguments.

The auxiliary operation \AgdaRef{σ₁ ⊕ σ₂} combines its argument behaviors,
letting the methods of \AgdaRef{σ₁} shadow those of \AgdaRef{σ₂}.
The operation \AgdaRef{w ⍄ p} combines the wrapper of a subclass with the generator of its parent class.
See Figure~9 of CP89 for an illustration of wrapper application.
%
\begin{code}%
%
\>[2]\AgdaFunction{Generator}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\<%
\\
%
\>[2]\AgdaFunction{Wrapper}%
\>[12]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}⊕\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\<%
\\
%
\>[2]\AgdaBound{σ₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊕}}\AgdaSpace{}%
\AgdaBound{σ₂}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{[}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{inl}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaBound{σ₂}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{]⊥}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{σ₁}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}⍄\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Wrapper}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Generator}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Generator}\<%
\\
%
\>[2]\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⍄}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{w}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊕}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{wrap}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Wrapper}\<%
\\
%
\>[2]\AgdaFunction{wrap}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{π}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{inl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{eval⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaBound{π}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{inr}\AgdaSpace{}%
\AgdaBound{⊥}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]?}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{methods}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSpace{}%
\AgdaBound{m}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{gen}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Class}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Generator}\<%
\\
%
\>[2]\AgdaFunction{gen}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{child}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{)}%
\>[19]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{wrap}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{child}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{κ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⍄}}\AgdaSpace{}%
\AgdaFunction{gen}\AgdaSpace{}%
\AgdaBound{κ}\<%
\\
%
\>[2]\AgdaFunction{gen}\AgdaSpace{}%
\AgdaInductiveConstructor{origin}%
\>[19]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{⊥}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{behave}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Instance}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟨}}\AgdaSpace{}%
\AgdaBound{Behavior}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{⟩}}\<%
\\
%
\>[2]\AgdaFunction{behave}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{fix}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{gen}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{class}\AgdaSpace{}%
\AgdaBound{ρ}\AgdaSymbol{))}\<%
\end{code}
\end{AgdaAlign}
%
That concludes the Agda formulation of the denotational semantics defined in CP89.